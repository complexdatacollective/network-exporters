{"version":3,"file":"index.js","sources":["../../src/FileExportManager.js"],"sourcesContent":["const { isEmpty, groupBy } = require('lodash');\nconst uuid = require('uuid').v4;\nconst path = require('path');\nconst { EventEmitter } = require('eventemitter3');\nconst queue = require('async/queue');\nconst {\n  protocolProperty,\n} = require('@codaco/shared-consts');\nconst exportFile = require('./exportFile');\nconst {\n  insertEgoIntoSessionNetworks,\n  resequenceIds,\n  partitionNetworkByType,\n  unionOfNetworks,\n} = require('./formatters/network');\nconst {\n  verifySessionVariables,\n  getFilePrefix,\n  getFileExportListFromFormats,\n  makeOptions,\n  makeFormats,\n} = require('./utils/general');\nconst { ExportError, ErrorMessages } = require('./consts/errors/ExportError');\nconst ProgressMessages = require('./consts/ProgressMessages');\nconst UserCancelledExport = require('./consts/errors/UserCancelledExport');\nconst MockFSInterface = require('./filesystem/testFs');\nconst { SUPPORTED_FORMATS } = require('./consts/export-consts');\n\n/**\n * Interface for all data exports\n */\nclass FileExportManager {\n  constructor(fsInterface = MockFSInterface) {\n    if (!fsInterface) {\n      throw new Error('Filesystem interface is required');\n    }\n\n    this.eventEmitter = new EventEmitter();\n    this.fsInterface = fsInterface;\n  }\n\n  static getSupportedFormats() {\n    return SUPPORTED_FORMATS;\n  }\n\n  on = (...args) => {\n    this.eventEmitter.on(...args);\n  };\n\n  emit(event, payload) {\n    if (!event) {\n      // eslint-disable-next-line no-console\n      console.warn('Malformed emit.');\n      return;\n    }\n\n    this.eventEmitter.emit(event, payload);\n  }\n\n  removeAllListeners = () => {\n    this.eventEmitter.removeAllListeners();\n  };\n\n  /**\n   * Main export method. Returns a promise that resolves an to an object\n   * containing an object with run() and abort() methods that control the task.\n   *\n   * Rejections from this method are fatal errors, but errors within\n   * the run() task only fail that specific task.\n   *\n   * @param {*} sessions    collection of session objects\n   * @param {*} protocols   object keyed by protocolUID (SHA of protocol.name), where each\n   *                        protocols[protocolUID] is a complete protocol object,\n   *                        including codebook. Must contain a key for every session\n   *                        protocol in the sessions collection.\n   */\n  prepareExportJob(\n    sessions,\n    protocols,\n    userFormats = ['graphml'],\n    userOptions = {},\n  ) {\n    // Merge user supplied options with defaults\n    const options = makeOptions(userOptions);\n    const formats = makeFormats(userFormats);\n\n    const tempDirectoryName = `temp-export-${uuid()}`;\n    const tempDirectoryPath = path.join(options.tempDataPath, tempDirectoryName);\n\n    // This queue instance accepts one or more promises and limits their\n    // concurrency for better usability in consuming apps\n    // https://caolan.github.io/async/v3/docs.html#queue\n    // TODO: refactor this to use web workers\n    const q = queue((task, callback) => {\n      task()\n        .then((result) => callback(null, result))\n        .catch((error) => callback(error));\n    }, options.queueConcurrency);\n\n    // Returns an array containing each file type that needs to be created.\n    const exportFormats = getFileExportListFromFormats(\n      formats,\n      options.csvIncludeAdjacencyMatrix,\n      options.csvIncludeAttributeList,\n      options.csvIncludeEdgeList,\n    );\n\n    // Cleanup function called by abort method, after fatal errors, and after\n    // the export promise resolves.\n    const cleanUp = () => {\n      q.kill();\n      this.fsInterface.deleteDirectory(tempDirectoryPath);\n    };\n\n    // Reject if required parameters aren't provided\n    if (\n      (!sessions || isEmpty(sessions))\n      || (!protocols || isEmpty(protocols))\n    ) {\n      throw new ExportError(ErrorMessages.MissingParameters);\n    }\n\n    let cancelled = false;\n    const completedExports = [];\n    const failedExports = [];\n\n    const shouldContinue = () => !cancelled;\n\n    // Main work of the process happens here\n    const run = () => new Promise((resolveRun, rejectRun) => {\n      this.emit('begin', ProgressMessages.Begin);\n\n      this.fsInterface.createDirectory(tempDirectoryPath)\n        .then(() => {\n          if (!shouldContinue()) {\n            throw new UserCancelledExport();\n          }\n        })\n        // Insert a reference to the ego ID into all nodes and edges\n        .then(() => {\n          this.emit('update', ProgressMessages.Formatting);\n          // Insert a reference to the ego ID into all nodes and edges\n          return insertEgoIntoSessionNetworks(sessions);\n        })\n        // Resequence IDs for this export\n        .then(resequenceIds)\n        // Group sessions by protocol UUID\n        .then((sessionsWithResequencedIDs) => groupBy(sessionsWithResequencedIDs, `sessionVariables.${protocolProperty}`))\n        // Then, process the union option\n        .then((sessionsByProtocol) => {\n          if (!shouldContinue()) {\n            throw new UserCancelledExport();\n          }\n\n          if (!options.unifyNetworks) {\n            return sessionsByProtocol;\n          }\n\n          this.emit('update', ProgressMessages.Merging);\n          return unionOfNetworks(sessionsByProtocol);\n        })\n        .then((unifiedSessions) => {\n          if (!shouldContinue()) {\n            throw new UserCancelledExport();\n          }\n\n          // Create an array of promises representing each session in each export format\n          const finishedSessions = [];\n\n          // Create a variable representing the total work to be done, so we can report progress\n          const sessionExportTotal = options.unifyNetworks\n            ? Object.keys(unifiedSessions).length : sessions.length;\n\n          // Array to contain all export work to be done\n          const promisedExports = [];\n\n          Object.keys(unifiedSessions).forEach((protocolUID) => {\n            // Reject if no protocol was provided for this session\n            if (!protocols[protocolUID]) {\n              const error = `No protocol was provided for the session. Looked for protocolUID ${protocolUID}`;\n              this.emit('error', error);\n              failedExports.push(error);\n              return;\n            }\n\n            unifiedSessions[protocolUID].forEach((session) => {\n              // Skip if sessions don't have required sessionVariables\n              try {\n                if (options.unifyNetworks) {\n                  Object.values(session.sessionVariables)\n                    .forEach((sessionVariables) => {\n                      verifySessionVariables(sessionVariables);\n                    });\n                } else {\n                  verifySessionVariables(session.sessionVariables);\n                }\n              } catch (e) {\n                failedExports.push(e);\n                return;\n              }\n\n              const protocol = protocols[protocolUID];\n              const prefix = getFilePrefix(\n                session,\n                protocol,\n                options.unifyNetworks,\n              );\n\n              // Returns promise resolving to filePath for each format exported\n              exportFormats.forEach((exportFormat) => {\n                // Partitioning the network based on node and edge type so we can create\n                // an individual export file for each type\n                const partitionedNetworks = partitionNetworkByType(\n                  protocol.codebook,\n                  session,\n                  exportFormat,\n                );\n\n                partitionedNetworks.forEach((partitionedNetwork) => {\n                  const partitionedEntity = partitionedNetwork.partitionEntity;\n                  promisedExports.push(() => new Promise((resolve, reject) => {\n                    try {\n                      exportFile(\n                        prefix,\n                        partitionedEntity,\n                        exportFormat,\n                        tempDirectoryPath,\n                        partitionedNetwork,\n                        protocol.codebook,\n                        fsInterface,\n                        options,\n                      ).then((result) => {\n                        if (!finishedSessions.includes(prefix)) {\n                          // If we unified the networks, we need to iterate sessionVariables and\n                          // emit a 'session-exported' event for each sessionID\n                          if (options.unifyNetworks) {\n                            Object.values(session.sessionVariables)\n                              .forEach((sessionVariables) => {\n                                this.emit('session-exported', sessionVariables.sessionId);\n                              });\n                          } else {\n                            this.emit('session-exported', session.sessionVariables.sessionId);\n                          }\n\n                          this.emit('update', ProgressMessages.ExportSession(finishedSessions.length + 1, sessionExportTotal));\n                          finishedSessions.push(prefix);\n                        }\n                        resolve(result);\n                      }).catch((e) => reject(e));\n                    } catch (error) {\n                      this.emit('error', `Encoding ${prefix} failed: ${error.message}`);\n                      this.emit('update', ProgressMessages.ExportSession(finishedSessions.length + 1, sessionExportTotal));\n                      reject(error);\n                    }\n                  }));\n                });\n              });\n            });\n          });\n\n          q.push(promisedExports, (err, result) => {\n            if (err) {\n              failedExports.push(err);\n              return;\n            }\n            completedExports.push(result);\n          });\n\n          return new Promise((resolve, reject) => {\n            q.drain().then(resolve).catch(reject);\n          });\n        })\n        // Then, return the paths to the exported files\n        .then(() => {\n          if (!shouldContinue()) {\n            throw new UserCancelledExport();\n          }\n\n          // FatalError if there are no sessions to encode and no errors\n          if (completedExports.length === 0 && failedExports.length === 0) {\n            throw new ExportError(ErrorMessages.NothingToExport);\n          }\n\n          // If we have no files to encode (but we do have errors), finish\n          // the task here so the user can see the errors\n          if (completedExports.length === 0) {\n            this.emit('finished', ProgressMessages.Finished);\n            cleanUp();\n            resolveRun();\n            cancelled = true;\n            return Promise.resolve();\n          }\n\n          cleanUp();\n          return resolveRun(completedExports);\n        })\n        .catch((err) => {\n          cleanUp();\n          // We don't reject if this is an error from user cancelling\n          if (!(err instanceof UserCancelledExport)) {\n            this.emit('cancelled', ProgressMessages.Cancelled);\n            rejectRun(err);\n          }\n        });\n    }); // End run()\n\n    const abort = () => {\n      // eslint-disable-next-line no-console\n      console.info('Aborting file export.');\n      if (!shouldContinue()) {\n        // eslint-disable-next-line no-console\n        console.warn('This export already aborted. Cancelling abort!');\n        return;\n      }\n      cancelled = true;\n    };\n\n    return { run, abort };\n  }\n}\n\nmodule.exports = FileExportManager;\n"],"names":[],"mappings":";;AAAA,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/C,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC;AAChC,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC7B,MAAM,EAAE,YAAY,EAAE,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAClD,MAAM,KAAK,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACrC,MAAM;AACN,EAAE,gBAAgB;AAClB,CAAC,GAAG,OAAO,CAAC,uBAAuB,CAAC,CAAC;AACrC,MAAM,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAC3C,MAAM;AACN,EAAE,4BAA4B;AAC9B,EAAE,aAAa;AACf,EAAE,sBAAsB;AACxB,EAAE,eAAe;AACjB,CAAC,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;AACpC,MAAM;AACN,EAAE,sBAAsB;AACxB,EAAE,aAAa;AACf,EAAE,4BAA4B;AAC9B,EAAE,WAAW;AACb,EAAE,WAAW;AACb,CAAC,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAC/B,MAAM,EAAE,WAAW,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC,6BAA6B,CAAC,CAAC;AAC9E,MAAM,gBAAgB,GAAG,OAAO,CAAC,2BAA2B,CAAC,CAAC;AAC9D,MAAM,mBAAmB,GAAG,OAAO,CAAC,qCAAqC,CAAC,CAAC;AAC3E,MAAM,eAAe,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AACvD,MAAM,EAAE,iBAAiB,EAAE,GAAG,OAAO,CAAC,wBAAwB,CAAC,CAAC;AAChE;AACA;AACA;AACA;AACA,MAAM,iBAAiB,CAAC;AACxB,EAAE,WAAW,CAAC,WAAW,GAAG,eAAe,EAAE;AAC7C,IAAI,IAAI,CAAC,WAAW,EAAE;AACtB,MAAM,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;AAC1D,KAAK;AACL;AACA,IAAI,IAAI,CAAC,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;AAC3C,IAAI,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AACnC,GAAG;AACH;AACA,EAAE,OAAO,mBAAmB,GAAG;AAC/B,IAAI,OAAO,iBAAiB,CAAC;AAC7B,GAAG;AACH;AACA,EAAE,EAAE,GAAG,CAAC,GAAG,IAAI,KAAK;AACpB,IAAI,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;AAClC,GAAG,CAAC;AACJ;AACA,EAAE,IAAI,CAAC,KAAK,EAAE,OAAO,EAAE;AACvB,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB;AACA,MAAM,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;AACtC,MAAM,OAAO;AACb,KAAK;AACL;AACA,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;AAC3C,GAAG;AACH;AACA,EAAE,kBAAkB,GAAG,MAAM;AAC7B,IAAI,IAAI,CAAC,YAAY,CAAC,kBAAkB,EAAE,CAAC;AAC3C,GAAG,CAAC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,gBAAgB;AAClB,IAAI,QAAQ;AACZ,IAAI,SAAS;AACb,IAAI,WAAW,GAAG,CAAC,SAAS,CAAC;AAC7B,IAAI,WAAW,GAAG,EAAE;AACpB,IAAI;AACJ;AACA,IAAI,MAAM,OAAO,GAAG,WAAW,CAAC,WAAW,CAAC,CAAC;AAC7C,IAAI,MAAM,OAAO,GAAG,WAAW,CAAC,WAAW,CAAC,CAAC;AAC7C;AACA,IAAI,MAAM,iBAAiB,GAAG,CAAC,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AACtD,IAAI,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,iBAAiB,CAAC,CAAC;AACjF;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC,IAAI,EAAE,QAAQ,KAAK;AACxC,MAAM,IAAI,EAAE;AACZ,SAAS,IAAI,CAAC,CAAC,MAAM,KAAK,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;AACjD,SAAS,KAAK,CAAC,CAAC,KAAK,KAAK,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;AAC3C,KAAK,EAAE,OAAO,CAAC,gBAAgB,CAAC,CAAC;AACjC;AACA;AACA,IAAI,MAAM,aAAa,GAAG,4BAA4B;AACtD,MAAM,OAAO;AACb,MAAM,OAAO,CAAC,yBAAyB;AACvC,MAAM,OAAO,CAAC,uBAAuB;AACrC,MAAM,OAAO,CAAC,kBAAkB;AAChC,KAAK,CAAC;AACN;AACA;AACA;AACA,IAAI,MAAM,OAAO,GAAG,MAAM;AAC1B,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;AACf,MAAM,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;AAC1D,KAAK,CAAC;AACN;AACA;AACA,IAAI;AACJ,MAAM,CAAC,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,CAAC;AACrC,UAAU,CAAC,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC;AAC3C,MAAM;AACN,MAAM,MAAM,IAAI,WAAW,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;AAC7D,KAAK;AACL;AACA,IAAI,IAAI,SAAS,GAAG,KAAK,CAAC;AAC1B,IAAI,MAAM,gBAAgB,GAAG,EAAE,CAAC;AAChC,IAAI,MAAM,aAAa,GAAG,EAAE,CAAC;AAC7B;AACA,IAAI,MAAM,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC;AAC5C;AACA;AACA,IAAI,MAAM,GAAG,GAAG,MAAM,IAAI,OAAO,CAAC,CAAC,UAAU,EAAE,SAAS,KAAK;AAC7D,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,gBAAgB,CAAC,KAAK,CAAC,CAAC;AACjD;AACA,MAAM,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,iBAAiB,CAAC;AACzD,SAAS,IAAI,CAAC,MAAM;AACpB,UAAU,IAAI,CAAC,cAAc,EAAE,EAAE;AACjC,YAAY,MAAM,IAAI,mBAAmB,EAAE,CAAC;AAC5C,WAAW;AACX,SAAS,CAAC;AACV;AACA,SAAS,IAAI,CAAC,MAAM;AACpB,UAAU,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,UAAU,CAAC,CAAC;AAC3D;AACA,UAAU,OAAO,4BAA4B,CAAC,QAAQ,CAAC,CAAC;AACxD,SAAS,CAAC;AACV;AACA,SAAS,IAAI,CAAC,aAAa,CAAC;AAC5B;AACA,SAAS,IAAI,CAAC,CAAC,0BAA0B,KAAK,OAAO,CAAC,0BAA0B,EAAE,CAAC,iBAAiB,EAAE,gBAAgB,CAAC,CAAC,CAAC,CAAC;AAC1H;AACA,SAAS,IAAI,CAAC,CAAC,kBAAkB,KAAK;AACtC,UAAU,IAAI,CAAC,cAAc,EAAE,EAAE;AACjC,YAAY,MAAM,IAAI,mBAAmB,EAAE,CAAC;AAC5C,WAAW;AACX;AACA,UAAU,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE;AACtC,YAAY,OAAO,kBAAkB,CAAC;AACtC,WAAW;AACX;AACA,UAAU,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,OAAO,CAAC,CAAC;AACxD,UAAU,OAAO,eAAe,CAAC,kBAAkB,CAAC,CAAC;AACrD,SAAS,CAAC;AACV,SAAS,IAAI,CAAC,CAAC,eAAe,KAAK;AACnC,UAAU,IAAI,CAAC,cAAc,EAAE,EAAE;AACjC,YAAY,MAAM,IAAI,mBAAmB,EAAE,CAAC;AAC5C,WAAW;AACX;AACA;AACA,UAAU,MAAM,gBAAgB,GAAG,EAAE,CAAC;AACtC;AACA;AACA,UAAU,MAAM,kBAAkB,GAAG,OAAO,CAAC,aAAa;AAC1D,cAAc,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;AACpE;AACA;AACA,UAAU,MAAM,eAAe,GAAG,EAAE,CAAC;AACrC;AACA,UAAU,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,CAAC,WAAW,KAAK;AAChE;AACA,YAAY,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,EAAE;AACzC,cAAc,MAAM,KAAK,GAAG,CAAC,iEAAiE,EAAE,WAAW,CAAC,CAAC,CAAC;AAC9G,cAAc,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACxC,cAAc,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACxC,cAAc,OAAO;AACrB,aAAa;AACb;AACA,YAAY,eAAe,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,KAAK;AAC9D;AACA,cAAc,IAAI;AAClB,gBAAgB,IAAI,OAAO,CAAC,aAAa,EAAE;AAC3C,kBAAkB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC;AACzD,qBAAqB,OAAO,CAAC,CAAC,gBAAgB,KAAK;AACnD,sBAAsB,sBAAsB,CAAC,gBAAgB,CAAC,CAAC;AAC/D,qBAAqB,CAAC,CAAC;AACvB,iBAAiB,MAAM;AACvB,kBAAkB,sBAAsB,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;AACnE,iBAAiB;AACjB,eAAe,CAAC,OAAO,CAAC,EAAE;AAC1B,gBAAgB,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACtC,gBAAgB,OAAO;AACvB,eAAe;AACf;AACA,cAAc,MAAM,QAAQ,GAAG,SAAS,CAAC,WAAW,CAAC,CAAC;AACtD,cAAc,MAAM,MAAM,GAAG,aAAa;AAC1C,gBAAgB,OAAO;AACvB,gBAAgB,QAAQ;AACxB,gBAAgB,OAAO,CAAC,aAAa;AACrC,eAAe,CAAC;AAChB;AACA;AACA,cAAc,aAAa,CAAC,OAAO,CAAC,CAAC,YAAY,KAAK;AACtD;AACA;AACA,gBAAgB,MAAM,mBAAmB,GAAG,sBAAsB;AAClE,kBAAkB,QAAQ,CAAC,QAAQ;AACnC,kBAAkB,OAAO;AACzB,kBAAkB,YAAY;AAC9B,iBAAiB,CAAC;AAClB;AACA,gBAAgB,mBAAmB,CAAC,OAAO,CAAC,CAAC,kBAAkB,KAAK;AACpE,kBAAkB,MAAM,iBAAiB,GAAG,kBAAkB,CAAC,eAAe,CAAC;AAC/E,kBAAkB,eAAe,CAAC,IAAI,CAAC,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC9E,oBAAoB,IAAI;AACxB,sBAAsB,UAAU;AAChC,wBAAwB,MAAM;AAC9B,wBAAwB,iBAAiB;AACzC,wBAAwB,YAAY;AACpC,wBAAwB,iBAAiB;AACzC,wBAAwB,kBAAkB;AAC1C,wBAAwB,QAAQ,CAAC,QAAQ;AACzC,wBAAwB,WAAW;AACnC,wBAAwB,OAAO;AAC/B,uBAAuB,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK;AACzC,wBAAwB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;AAChE;AACA;AACA,0BAA0B,IAAI,OAAO,CAAC,aAAa,EAAE;AACrD,4BAA4B,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC;AACnE,+BAA+B,OAAO,CAAC,CAAC,gBAAgB,KAAK;AAC7D,gCAAgC,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,SAAS,CAAC,CAAC;AAC1F,+BAA+B,CAAC,CAAC;AACjC,2BAA2B,MAAM;AACjC,4BAA4B,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,OAAO,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;AAC9F,2BAA2B;AAC3B;AACA,0BAA0B,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE,kBAAkB,CAAC,CAAC,CAAC;AAC/H,0BAA0B,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACxD,yBAAyB;AACzB,wBAAwB,OAAO,CAAC,MAAM,CAAC,CAAC;AACxC,uBAAuB,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACjD,qBAAqB,CAAC,OAAO,KAAK,EAAE;AACpC,sBAAsB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,SAAS,EAAE,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACxF,sBAAsB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE,kBAAkB,CAAC,CAAC,CAAC;AAC3H,sBAAsB,MAAM,CAAC,KAAK,CAAC,CAAC;AACpC,qBAAqB;AACrB,mBAAmB,CAAC,CAAC,CAAC;AACtB,iBAAiB,CAAC,CAAC;AACnB,eAAe,CAAC,CAAC;AACjB,aAAa,CAAC,CAAC;AACf,WAAW,CAAC,CAAC;AACb;AACA,UAAU,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,GAAG,EAAE,MAAM,KAAK;AACnD,YAAY,IAAI,GAAG,EAAE;AACrB,cAAc,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACtC,cAAc,OAAO;AACrB,aAAa;AACb,YAAY,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC1C,WAAW,CAAC,CAAC;AACb;AACA,UAAU,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAClD,YAAY,CAAC,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAClD,WAAW,CAAC,CAAC;AACb,SAAS,CAAC;AACV;AACA,SAAS,IAAI,CAAC,MAAM;AACpB,UAAU,IAAI,CAAC,cAAc,EAAE,EAAE;AACjC,YAAY,MAAM,IAAI,mBAAmB,EAAE,CAAC;AAC5C,WAAW;AACX;AACA;AACA,UAAU,IAAI,gBAAgB,CAAC,MAAM,KAAK,CAAC,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE;AAC3E,YAAY,MAAM,IAAI,WAAW,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;AACjE,WAAW;AACX;AACA;AACA;AACA,UAAU,IAAI,gBAAgB,CAAC,MAAM,KAAK,CAAC,EAAE;AAC7C,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,gBAAgB,CAAC,QAAQ,CAAC,CAAC;AAC7D,YAAY,OAAO,EAAE,CAAC;AACtB,YAAY,UAAU,EAAE,CAAC;AACzB,YAAY,SAAS,GAAG,IAAI,CAAC;AAC7B,YAAY,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AACrC,WAAW;AACX;AACA,UAAU,OAAO,EAAE,CAAC;AACpB,UAAU,OAAO,UAAU,CAAC,gBAAgB,CAAC,CAAC;AAC9C,SAAS,CAAC;AACV,SAAS,KAAK,CAAC,CAAC,GAAG,KAAK;AACxB,UAAU,OAAO,EAAE,CAAC;AACpB;AACA,UAAU,IAAI,EAAE,GAAG,YAAY,mBAAmB,CAAC,EAAE;AACrD,YAAY,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,gBAAgB,CAAC,SAAS,CAAC,CAAC;AAC/D,YAAY,SAAS,CAAC,GAAG,CAAC,CAAC;AAC3B,WAAW;AACX,SAAS,CAAC,CAAC;AACX,KAAK,CAAC,CAAC;AACP;AACA,IAAI,MAAM,KAAK,GAAG,MAAM;AACxB;AACA,MAAM,OAAO,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;AAC5C,MAAM,IAAI,CAAC,cAAc,EAAE,EAAE;AAC7B;AACA,QAAQ,OAAO,CAAC,IAAI,CAAC,gDAAgD,CAAC,CAAC;AACvE,QAAQ,OAAO;AACf,OAAO;AACP,MAAM,SAAS,GAAG,IAAI,CAAC;AACvB,KAAK,CAAC;AACN;AACA,IAAI,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC;AAC1B,GAAG;AACH,CAAC;AACD;AACA,MAAM,CAAC,OAAO,GAAG,iBAAiB;;"}